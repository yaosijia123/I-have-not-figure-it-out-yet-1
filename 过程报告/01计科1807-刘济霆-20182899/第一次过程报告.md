

## 第一次过程报告

### 一、具体工作

​        对于编译器前端的设计，我主要负责的是符号表的填写和管理，相对来说，难以上手，所以第一阶段的上机实验有小部分时间是用在复习PPT和查找资料上的，目前完成了符号表、数组表和活动记录的数据结构设计，对表操作的函数有待继续开发（完成了初始化和读取token转化部分）。此外，作为本组的组长，主要负责文法的设计和改动，并与组员不断的沟通和验证，完成了文法的设计，其中在学长学姐的知道下，不断完善，包括了选择（$if、else$）、循环（$while、for$）、情况语句（$switch$）、跳转语句（$break、continue、return$）、输入输出语句（$scanf、printf$）以及结构体的设计（$struct$）。

### 二、个人进度

文法设计如下：

```c
//文法第二版
<函数定义> -> <类型> <标识符> ( <参数声明> ) { <函数块> } | $ 
<类型> ->int | double | char | void | $
<程序> -> <声明语句闭包> <函数定义> <主函数>
<主函数> -> int main‘(’‘)’‘{’<函数块>‘}’
<结构体声明> -> typedef struct <标识符> ‘{’＜变量说明＞‘}’ <标识符> 
    		  | typedef struct ‘{’＜变量说明＞‘}’ <标识符> 
<因式> -> ( <表达式> ) | <标识符> | <数字> | <字符>
<表达式> -> <因子> <项>  
<因子> -> <因式> <因式递归>  
<因式递归> -> * <因式> <因式递归> | / <因式> <因式递归> | $  
<项> -> + <因子> <项> | - <因子> <项> | $  
<参数声明> -> <声明> <声明闭包> | $  
<声明> ->  <类型> <标识符> <赋初值>  | <标识符><赋初值> | <标识符> <标识符>
<赋初值> -> = <右值> | $  
<右值> -> <表达式>
<声明闭包> -> , <声明> <声明闭包> | $  
<函数块> -> <声明语句闭包> <函数块闭包>  
<声明语句闭包> -> <声明语句> <声明语句闭包> | $  
<声明语句> -> <声明> ; | <结构体声明> ;
<函数块闭包> -> <赋值函数> <函数块闭包> | <循环语句> <函数块闭包> | <条件语句> <函数块闭包> | <函数返回> <函数块闭包> | <读语句> | <写语句> | <情况语句> <函数块闭包> | $
<赋值函数> -> <标识符> <赋值或函数调用>  
<赋值或函数调用> -> = <右值> ; | ( <参数列表> ) ;  
<参数列表> -> <参数> <参数闭包>  
<参数闭包> -> , <参数> <参数闭包> | $  
<参数> -> <标识符> | <数字> | <字符串> 
<循环语句> -> while ‘(’<逻辑表达式>‘)’ { <函数块> } | for '(' <声明> ; <逻辑表达式> ;＜标识符＞= <表达式> ')' { <函数块> } 
<逻辑表达式> -> <表达式> <逻辑运算符> <表达式>  
<逻辑运算符> -> < | > | == | >= | <=  
<条件语句> -> if ( <逻辑表达式> ) { <函数块> } <否则语句>  
<否则语句> -> else { <函数块> } | $  
<情况语句> -> switch ‘(’<标识符>‘)’ ‘{’<情况表> <缺省>‘}’
<情况表> -> ＜情况子语句＞ ＜情况子语句闭包＞
<情况子语句闭包> -> ＜情况子语句＞ ＜情况子语句闭包＞
<情况子语句＞ -> case <数字> ：<函数块闭包> |case <字符>：<函数块闭包>
<缺省> -> default <数字> ：<函数块闭包> | default <字符> ：<函数块闭包> | $
<读语句> -> scanf ‘(’<字符串>,<参数列表>‘)’ ;
<写语句> -> printf ‘(’ <字符串>,<参数列表> ‘)’  ; | printf ‘(’ <字符串> ‘)’ ; 
<函数返回> -> continue ;| break ; | return <因式> ; |return ;
```

符号表数据结构定义如下：

```c
struct synbl {  //符号表
	string name; //名字
	vector<typel>* type;   //类型
	CAT kind;    //种类
	void* addr;   //地址指针
}
```

类型表定义如下：

```c
enum TVAL { INT, DOUBLE, CHAR, BOOL, ARRAY, STRUCT };
//类型，包括 int，double, char, bool, array, struct型

struct typel { //类型表
	TVAL tval;
	void* tpoint;   //类型指针，基本数据类型为空指针，数组指向数组表，结构体指向结构表
};
```

函数表定义如下：

```c
struct pfinfl { //函数表
	int level;  //层次号
	int off;    //区距
	int fn;	    //参数个数
	vector<synbl>* param;     //参数表指针，指向形参表；
	long entry; //入口地址
};
```

数组表定义如下：

```c
struct ainfl { //数组表
	int low; //数组的下界 -- C语言自动设为：0
	int up;  //数组的上界
	vector<typel>* ctp; //成分类型指针– 指针，指向该维数组成分类型(在类型表中的信息)
	int clen; // 成分类型的长度– 成分类型的数据所占值单元的个数(数依字长为单位计算)
};
```

活动记录类定义如下：

```c
class vall { //活动记录表
private:
	int old_sp; //老SP
	int global_display; //全局display
	int parameter_num; //参数个数
	vector<int> parameter; //参数
	vector<int> display_table; //display表
	vector<int> local_variables; //局部变量
	vector<int> info_vector; //内情向量
	vector<int> temp_variables; //临时变量

};
```

完整符号表类定义如下：

```c
class sym_table {
private:
	vector<token> TOKEN; //TOKEN 流
	vector<synbl> SYNBL; //符号表
	vector<typel> TYPEL; //类型表
	vector<pfinfl> PFINFL; //函数表
	vector<ainfl> AINFL; //数组表
	vector<double> CONSL; //常量表
	vector<int> lenl; //长度表
public:
	sym_table(); //构造函数
	void init_TYPEL(); //初始化符号表
	void read_file(); //读token文件
	void analysis_table(); //分析符号表
};
```

### 三、第一阶段总结

​        第一阶段的工作，主要是撰写文法，做好复习，把符号表填写和管理的逻辑思路理顺。非常感谢孟霞学姐的悉心指导，为我们组解答了很多的疑惑，更是不断建议我先理顺思路，不要着急写代码。现在来看是非常正确的，因为再一遍学习老师的PPT的时候，确实发现了好多当时完全没有注意到的点，这些关键点在设计的时候就显得非常重要，在有了一定的积累后，符号表等数据结构设计的非常流畅，更是让我的编译知识体系查漏补缺，完善了起来，由此可见课设的重要性。

​		作为组长，我要负责的不仅仅是个人工作部分的程序设计，还要做好统筹兼顾，所以我组织大家开了三次腾讯会议，完成了接口的约定和文法的推敲。我们组的组员都十分配合，大家在一起讨论，也并不局限于自己的工作，共同解决了很多问题，加强了小组合作和交流。

​		最后，我深切感受到了编译课题组的老师学长学姐们的用心，作为转专业的学生，来到这里一年的时间里，不仅完成了正常的课设安排，还补修了很多课设，但很少有如此用心的安排与督促。不仅学长学姐私下会认真解答问题，在交流会上老师也亲自坐镇，给出宝贵的意见，真的是十分难得，我也会抓住这次机会，认真学好编译这门课，不辜负老师和学姐的苦心。